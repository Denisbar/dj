<!DOCTYPE html>
<!-- saved from url=(0036)http://bl.ocks.org/stepheneb/1182434 -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="viewport" content="width=1000">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@mbostock">
<meta property="og:url" content="http://bl.ocks.org/stepheneb/1182434">
<meta property="og:title" content="D3 Example: zoom, pan, and axis rescale">
<meta property="og:description" content="Stephen Bannasch’s Block 1182434">
<title>D3 Example: zoom, pan, and axis rescale - bl.ocks.org</title>
<link rel="icon" href="http://bl.ocks.org/favicon.png">
<style>

@import url("/style.css");

</style>

</head><body><header>
  <div class="column">
    <div class="navigation">
      <a href="http://bl.ocks.org/">Popular</a>
      / <a href="http://bl.ocks.org/-/about">About</a>
    </div>
    <a class="user" href="http://bl.ocks.org/stepheneb"><img class="avatar" src="./D3 Example_ zoom, pan, and axis rescale - bl.ocks.org_files/7188" width="30" height="30">Stephen Bannasch</a>’s
    Block <a class="gist gist-id self" title="View Gist on GitHub." href="https://gist.github.com/stepheneb/1182434">1182434</a>    <div class="date">Updated May 11, 2016</div>
  </div>
</header>

<div class="column">
  <h1>D3 Example: zoom, pan, and axis rescale</h1>
  <div class="index">
    <iframe sandbox="allow-popups allow-scripts allow-forms allow-same-origin" src="./D3 Example_ zoom, pan, and axis rescale - bl.ocks.org_files/saved_resource.html" marginwidth="0" marginheight="0" style="height:500px;" scrolling="no"></iframe>
  </div>
  <div class="index-pop">
    <a target="_blank" title="Open Block 1182434 a new window." href="http://bl.ocks.org/stepheneb/raw/1182434">Open<svg height="16" width="12"><path d="M11 10h1v3c0 0.55-0.45 1-1 1H1c-0.55 0-1-0.45-1-1V3c0-0.55 0.45-1 1-1h3v1H1v10h10V10zM6 2l2.25 2.25-3.25 3.25 1.5 1.5 3.25-3.25 2.25 2.25V2H6z"></path></svg></a>
  </div>
  <div class="gist-readme" data-key="readme.md"><p><a href="http://bl.ocks.org/1182434">This example</a> is a mashup of the <a href="https://github.com/mbostock/d3">D3</a> <strong>Zoom-Pan</strong> example along with <a href="http://bl.ocks.org/1179647">Ricardo Marimon's example of X-axis re-scaling by dragging</a>.</p>

<ul>
<li>Drag on the canvas to translate/pan the graph.</li>
<li>double-click on the canvas to zoom in</li>
<li>shift-double-click on the canvas to zoom out</li>
<li>Drag on one of the X or Y axis numeric labels to re-scale that axis</li>
<li>click on a data point to select it</li>
<li>drag a selected data point up or down to change it's Y value</li>
<li>enter the delete or backspace key to delete a selected data point</li>
<li>hold the ALT/Option key down and click an empty area of the graph to add a data point</li>
</ul>

<p>Most of the UI should also work with the touch events generated by a tablet or SmartPhone.</p>

<p><em>source: <a href="https://gist.github.com/1182434">gist.github.com/1182434</a></em></p>

<h3 id="d3references">D3 References:</h3>

<ul>
<li><a href="https://github.com/mbostock/d3">repository</a></li>
<li><a href="http://mbostock.github.com/d3/">wiki</a></li>
<li><a href="http://mbostock.github.com/d3/ex/">examples</a></li>
<li><a href="https://github.com/mbostock/d3/wiki/API-Reference">API</a></li>
<li><a href="https://github.com/mbostock/d3/wiki/Quantitative-Scales">Quantitative Scales</a></li>
</ul>

<h3 id="d3tutorials">D3 Tutorials:</h3>

<ul>
<li><a href="http://mbostock.github.com/d3/tutorial/circle.html">Three Little Circles</a></li>
<li><a href="http://mbostock.github.com/d3/tutorial/bar-1.html">A Bar Chart, Part 1</a></li>
<li><a href="http://mbostock.github.com/d3/tutorial/bar-2.html">A Bar Chart, Part 2</a></li>
</ul>

<h3 id="externald3tutorials">External D3 Tutorials</h3>

<ul>
<li><a href="http://christopheviau.com/d3_tutorial/">Try D3 Now</a></li>
<li><a href="http://www.janwillemtulp.com/2011/03/31/tutorialthe-basics-working-with-arrays-in-d3/">Array Basics</a></li>
<li><a href="http://www.janwillemtulp.com/2011/03/23/tutorial-line-interpolations-in-d3/">Line Interpolations</a></li>
<li><a href="http://www.janwillemtulp.com/2011/04/01/tutorial-line-chart-in-d3/">Line Chart</a></li>
<li><a href="http://www.janwillemtulp.com/2011/03/22/tutorial-conways-game-of-life-in-d3/">Conway's Game of Life</a></li>
<li><a href="http://www.janwillemtulp.com/2011/03/20/tutorial-introduction-to-d3/">Introudction</a></li>
</ul>

<h3 id="svggraphics">SVG Graphics</h3>

<ul>
<li><a href="http://www.w3.org/TR/SVG/">standard</a></li>
</ul></div>
  <div class="gist-sources">
    <div class="gist-source" data-key="index.html">
      <h2>index.html<a name="index.html" class="anchor" href="http://bl.ocks.org/stepheneb/1182434#index.html">#</a></h2>
      <pre><code class="html xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">html</span>&gt;</span>
  <span class="tag">&lt;<span class="title">head</span>&gt;</span>
    <span class="tag">&lt;<span class="title">meta</span> <span class="attribute">http-equiv</span>=<span class="value">"Content-Type"</span> <span class="attribute">content</span>=<span class="value">"text/html;charset=utf-8"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">title</span>&gt;</span>One Graph<span class="tag">&lt;/<span class="title">title</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"http://mbostock.github.com/d3/d3.v2.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span> <span class="attribute">src</span>=<span class="value">"simple-graph.js"</span>&gt;</span><span class="javascript"></span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
    <span class="tag">&lt;<span class="title">style</span> <span class="attribute">type</span>=<span class="value">"text/css"</span>&gt;</span><span class="css">
      <span class="tag">body</span> <span class="rules">{ <span class="rule"><span class="attribute">font</span>:<span class="value"> <span class="number">13</span>px sans-serif</span>;</span> <span class="rule">}</span></span>
      <span class="tag">rect</span> <span class="rules">{ <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="hexcolor">#fff</span></span>;</span> <span class="rule">}</span></span>
      <span class="tag">ul</span> <span class="rules">{
        <span class="rule"><span class="attribute">list-style-type</span>:<span class="value"> none</span>;</span>
        <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0.5</span>em <span class="number">0</span>em <span class="number">0.5</span>em <span class="number">0</span>em</span>;</span>
        <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">100</span>%</span>;</span> <span class="rule">}</span></span>
        <span class="tag">ul</span> <span class="tag">li</span> <span class="rules">{
          <span class="rule"><span class="attribute">display</span>:<span class="value"> table-cell</span>;</span>
          <span class="rule"><span class="attribute">vertical-align</span>:<span class="value"> middle</span>;</span>
          <span class="rule"><span class="attribute">margin</span>:<span class="value"> <span class="number">0</span>em</span>;</span>
          <span class="rule"><span class="attribute">padding</span>:<span class="value"> <span class="number">0</span>em <span class="number">1</span>em</span>;</span> <span class="rule">}</span></span>
      <span class="class">.axis</span> <span class="rules">{ <span class="rule"><span class="attribute">font-size</span>:<span class="value"> <span class="number">1.5</span>em</span>;</span> <span class="rule">}</span></span>
      <span class="class">.chart</span> <span class="rules">{
        <span class="rule"><span class="attribute">background-color</span>:<span class="value"> <span class="hexcolor">#F7F2C5</span></span>;</span>
        <span class="rule"><span class="attribute">width</span>:<span class="value"> <span class="number">960</span>px</span>;</span>
        <span class="rule"><span class="attribute">height</span>:<span class="value"> <span class="number">500</span>px</span>;</span> <span class="rule">}</span></span>
      <span class="tag">circle</span>, <span class="class">.line</span> <span class="rules">{
        <span class="rule"><span class="attribute">fill</span>:<span class="value"> none</span>;</span>
        <span class="rule"><span class="attribute">stroke</span>:<span class="value"> steelblue</span>;</span>
        <span class="rule"><span class="attribute">stroke-width</span>:<span class="value"> <span class="number">2</span>px</span>;</span> <span class="rule">}</span></span>
      <span class="tag">circle</span> <span class="rules">{
        <span class="rule"><span class="attribute">fill</span>:<span class="value"> white</span>;</span>
        <span class="rule"><span class="attribute">fill-opacity</span>:<span class="value"> <span class="number">0.2</span></span>;</span>
        <span class="rule"><span class="attribute">cursor</span>:<span class="value"> move</span>;</span> <span class="rule">}</span></span>
        <span class="tag">circle</span><span class="class">.selected</span> <span class="rules">{
          <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="hexcolor">#ff7f0e</span></span>;</span>
          <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="hexcolor">#ff7f0e</span></span>;</span> <span class="rule">}</span></span>
        <span class="tag">circle</span><span class="pseudo">:hover</span> <span class="rules">{
          <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="hexcolor">#ff7f0e</span></span>;</span>
          <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="number">#707f0e</span></span>;</span> <span class="rule">}</span></span>
        <span class="tag">circle</span><span class="class">.selected</span><span class="pseudo">:hover</span> <span class="rules">{
          <span class="rule"><span class="attribute">fill</span>:<span class="value"> <span class="hexcolor">#ff7f0e</span></span>;</span>
          <span class="rule"><span class="attribute">stroke</span>:<span class="value"> <span class="hexcolor">#ff7f0e</span></span>;</span> <span class="rule">}</span></span>
    </span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">head</span>&gt;</span>
  <span class="tag">&lt;<span class="title">body</span>&gt;</span>
    <span class="tag">&lt;<span class="title">div</span> <span class="attribute">id</span>=<span class="value">"chart1"</span> <span class="attribute">class</span>=<span class="value">"chart"</span>&gt;</span><span class="tag">&lt;/<span class="title">div</span>&gt;</span>
    <span class="tag">&lt;<span class="title">script</span> <span class="attribute">type</span>=<span class="value">"text/javascript"</span>&gt;</span><span class="javascript">
      graph = <span class="keyword">new</span> SimpleGraph(<span class="string">"chart1"</span>, {
          <span class="string">"xmax"</span>: <span class="number">60</span>, <span class="string">"xmin"</span>: <span class="number">0</span>,
          <span class="string">"ymax"</span>: <span class="number">40</span>, <span class="string">"ymin"</span>: <span class="number">0</span>, 
          <span class="string">"title"</span>: <span class="string">"Simple Graph1"</span>,
          <span class="string">"xlabel"</span>: <span class="string">"X Axis"</span>,
          <span class="string">"ylabel"</span>: <span class="string">"Y Axis"</span>  
        });
    </span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
  <span class="tag">&lt;/<span class="title">body</span>&gt;</span>
<span class="tag">&lt;/<span class="title">html</span>&gt;</span>

</code></pre>
    </div>
    <div class="gist-source" data-key="simple-graph.js">
      <h2>simple-graph.js<a name="simple-graph.js" class="anchor" href="http://bl.ocks.org/stepheneb/1182434#simple-graph.js">#</a></h2>
      <pre><code class="javascript">registerKeyboardHandler = <span class="function"><span class="keyword">function</span><span class="params">(callback)</span> {</span>
  <span class="keyword">var</span> callback = callback;
  d3.select(window).on(<span class="string">"keydown"</span>, callback);  
};

SimpleGraph = <span class="function"><span class="keyword">function</span><span class="params">(elemid, options)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">this</span>.chart = document.getElementById(elemid);
  <span class="keyword">this</span>.cx = <span class="keyword">this</span>.chart.clientWidth;
  <span class="keyword">this</span>.cy = <span class="keyword">this</span>.chart.clientHeight;
  <span class="keyword">this</span>.options = options || {};
  <span class="keyword">this</span>.options.xmax = options.xmax || <span class="number">30</span>;
  <span class="keyword">this</span>.options.xmin = options.xmin || <span class="number">0</span>;
  <span class="keyword">this</span>.options.ymax = options.ymax || <span class="number">10</span>;
  <span class="keyword">this</span>.options.ymin = options.ymin || <span class="number">0</span>;

  <span class="keyword">this</span>.padding = {
     <span class="string">"top"</span>:    <span class="keyword">this</span>.options.title  ? <span class="number">40</span> : <span class="number">20</span>,
     <span class="string">"right"</span>:                 <span class="number">30</span>,
     <span class="string">"bottom"</span>: <span class="keyword">this</span>.options.xlabel ? <span class="number">60</span> : <span class="number">10</span>,
     <span class="string">"left"</span>:   <span class="keyword">this</span>.options.ylabel ? <span class="number">70</span> : <span class="number">45</span>
  };

  <span class="keyword">this</span>.size = {
    <span class="string">"width"</span>:  <span class="keyword">this</span>.cx - <span class="keyword">this</span>.padding.left - <span class="keyword">this</span>.padding.right,
    <span class="string">"height"</span>: <span class="keyword">this</span>.cy - <span class="keyword">this</span>.padding.top  - <span class="keyword">this</span>.padding.bottom
  };

  <span class="comment">// x-scale</span>
  <span class="keyword">this</span>.x = d3.scale.linear()
      .domain([<span class="keyword">this</span>.options.xmin, <span class="keyword">this</span>.options.xmax])
      .range([<span class="number">0</span>, <span class="keyword">this</span>.size.width]);

  <span class="comment">// drag x-axis logic</span>
  <span class="keyword">this</span>.downx = Math.NaN;

  <span class="comment">// y-scale (inverted domain)</span>
  <span class="keyword">this</span>.y = d3.scale.linear()
      .domain([<span class="keyword">this</span>.options.ymax, <span class="keyword">this</span>.options.ymin])
      .nice()
      .range([<span class="number">0</span>, <span class="keyword">this</span>.size.height])
      .nice();

  <span class="comment">// drag y-axis logic</span>
  <span class="keyword">this</span>.downy = Math.NaN;

  <span class="keyword">this</span>.dragged = <span class="keyword">this</span>.selected = <span class="literal">null</span>;

  <span class="keyword">this</span>.line = d3.svg.line()
      .x(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span> <span class="keyword">return</span> <span class="keyword">this</span>.x(<span class="keyword">this</span>.points[i].x); })
      .y(<span class="function"><span class="keyword">function</span><span class="params">(d, i)</span> {</span> <span class="keyword">return</span> <span class="keyword">this</span>.y(<span class="keyword">this</span>.points[i].y); });

  <span class="keyword">var</span> xrange =  (<span class="keyword">this</span>.options.xmax - <span class="keyword">this</span>.options.xmin),
      yrange2 = (<span class="keyword">this</span>.options.ymax - <span class="keyword">this</span>.options.ymin) / <span class="number">2</span>,
      yrange4 = yrange2 / <span class="number">2</span>,
      datacount = <span class="keyword">this</span>.size.width/<span class="number">30</span>;

  <span class="keyword">this</span>.points = d3.range(datacount).map(<span class="function"><span class="keyword">function</span><span class="params">(i)</span> {</span> 
    <span class="keyword">return</span> { x: i * xrange / datacount, y: <span class="keyword">this</span>.options.ymin + yrange4 + Math.random() * yrange2 }; 
  }, self);

  <span class="keyword">this</span>.vis = d3.select(<span class="keyword">this</span>.chart).append(<span class="string">"svg"</span>)
      .attr(<span class="string">"width"</span>,  <span class="keyword">this</span>.cx)
      .attr(<span class="string">"height"</span>, <span class="keyword">this</span>.cy)
      .append(<span class="string">"g"</span>)
        .attr(<span class="string">"transform"</span>, <span class="string">"translate("</span> + <span class="keyword">this</span>.padding.left + <span class="string">","</span> + <span class="keyword">this</span>.padding.top + <span class="string">")"</span>);

  <span class="keyword">this</span>.plot = <span class="keyword">this</span>.vis.append(<span class="string">"rect"</span>)
      .attr(<span class="string">"width"</span>, <span class="keyword">this</span>.size.width)
      .attr(<span class="string">"height"</span>, <span class="keyword">this</span>.size.height)
      .style(<span class="string">"fill"</span>, <span class="string">"#EEEEEE"</span>)
      .attr(<span class="string">"pointer-events"</span>, <span class="string">"all"</span>)
      .on(<span class="string">"mousedown.drag"</span>, self.plot_drag())
      .on(<span class="string">"touchstart.drag"</span>, self.plot_drag())
      <span class="keyword">this</span>.plot.call(d3.behavior.zoom().x(<span class="keyword">this</span>.x).y(<span class="keyword">this</span>.y).on(<span class="string">"zoom"</span>, <span class="keyword">this</span>.redraw()));

  <span class="keyword">this</span>.vis.append(<span class="string">"svg"</span>)
      .attr(<span class="string">"top"</span>, <span class="number">0</span>)
      .attr(<span class="string">"left"</span>, <span class="number">0</span>)
      .attr(<span class="string">"width"</span>, <span class="keyword">this</span>.size.width)
      .attr(<span class="string">"height"</span>, <span class="keyword">this</span>.size.height)
      .attr(<span class="string">"viewBox"</span>, <span class="string">"0 0 "</span>+<span class="keyword">this</span>.size.width+<span class="string">" "</span>+<span class="keyword">this</span>.size.height)
      .attr(<span class="string">"class"</span>, <span class="string">"line"</span>)
      .append(<span class="string">"path"</span>)
          .attr(<span class="string">"class"</span>, <span class="string">"line"</span>)
          .attr(<span class="string">"d"</span>, <span class="keyword">this</span>.line(<span class="keyword">this</span>.points));

  <span class="comment">// add Chart Title</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.options.title) {
    <span class="keyword">this</span>.vis.append(<span class="string">"text"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"axis"</span>)
        .text(<span class="keyword">this</span>.options.title)
        .attr(<span class="string">"x"</span>, <span class="keyword">this</span>.size.width/<span class="number">2</span>)
        .attr(<span class="string">"dy"</span>,<span class="string">"-0.8em"</span>)
        .style(<span class="string">"text-anchor"</span>,<span class="string">"middle"</span>);
  }

  <span class="comment">// Add the x-axis label</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.options.xlabel) {
    <span class="keyword">this</span>.vis.append(<span class="string">"text"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"axis"</span>)
        .text(<span class="keyword">this</span>.options.xlabel)
        .attr(<span class="string">"x"</span>, <span class="keyword">this</span>.size.width/<span class="number">2</span>)
        .attr(<span class="string">"y"</span>, <span class="keyword">this</span>.size.height)
        .attr(<span class="string">"dy"</span>,<span class="string">"2.4em"</span>)
        .style(<span class="string">"text-anchor"</span>,<span class="string">"middle"</span>);
  }

  <span class="comment">// add y-axis label</span>
  <span class="keyword">if</span> (<span class="keyword">this</span>.options.ylabel) {
    <span class="keyword">this</span>.vis.append(<span class="string">"g"</span>).append(<span class="string">"text"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"axis"</span>)
        .text(<span class="keyword">this</span>.options.ylabel)
        .style(<span class="string">"text-anchor"</span>,<span class="string">"middle"</span>)
        .attr(<span class="string">"transform"</span>,<span class="string">"translate("</span> + -<span class="number">40</span> + <span class="string">" "</span> + <span class="keyword">this</span>.size.height/<span class="number">2</span>+<span class="string">") rotate(-90)"</span>);
  }

  d3.select(<span class="keyword">this</span>.chart)
      .on(<span class="string">"mousemove.drag"</span>, self.mousemove())
      .on(<span class="string">"touchmove.drag"</span>, self.mousemove())
      .on(<span class="string">"mouseup.drag"</span>,   self.mouseup())
      .on(<span class="string">"touchend.drag"</span>,  self.mouseup());

  <span class="keyword">this</span>.redraw()();
};
  
<span class="comment">//</span>
<span class="comment">// SimpleGraph methods</span>
<span class="comment">//</span>

SimpleGraph.prototype.plot_drag = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    registerKeyboardHandler(self.keydown());
    d3.select(<span class="string">'body'</span>).style(<span class="string">"cursor"</span>, <span class="string">"move"</span>);
    <span class="keyword">if</span> (d3.event.altKey) {
      <span class="keyword">var</span> p = d3.svg.mouse(self.vis.node());
      <span class="keyword">var</span> newpoint = {};
      newpoint.x = self.x.invert(Math.max(<span class="number">0</span>, Math.min(self.size.width,  p[<span class="number">0</span>])));
      newpoint.y = self.y.invert(Math.max(<span class="number">0</span>, Math.min(self.size.height, p[<span class="number">1</span>])));
      self.points.push(newpoint);
      self.points.sort(<span class="function"><span class="keyword">function</span><span class="params">(a, b)</span> {</span>
        <span class="keyword">if</span> (a.x &lt; b.x) { <span class="keyword">return</span> -<span class="number">1</span> };
        <span class="keyword">if</span> (a.x &gt; b.x) { <span class="keyword">return</span>  <span class="number">1</span> };
        <span class="keyword">return</span> <span class="number">0</span>
      });
      self.selected = newpoint;
      self.update();
      d3.event.preventDefault();
      d3.event.stopPropagation();
    }    
  }
};

SimpleGraph.prototype.update = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">var</span> lines = <span class="keyword">this</span>.vis.select(<span class="string">"path"</span>).attr(<span class="string">"d"</span>, <span class="keyword">this</span>.line(<span class="keyword">this</span>.points));
        
  <span class="keyword">var</span> circle = <span class="keyword">this</span>.vis.select(<span class="string">"svg"</span>).selectAll(<span class="string">"circle"</span>)
      .data(<span class="keyword">this</span>.points, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d; });

  circle.enter().append(<span class="string">"circle"</span>)
      .attr(<span class="string">"class"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d === self.selected ? <span class="string">"selected"</span> : <span class="literal">null</span>; })
      .attr(<span class="string">"cx"</span>,    <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> self.x(d.x); })
      .attr(<span class="string">"cy"</span>,    <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> self.y(d.y); })
      .attr(<span class="string">"r"</span>, <span class="number">10.0</span>)
      .style(<span class="string">"cursor"</span>, <span class="string">"ns-resize"</span>)
      .on(<span class="string">"mousedown.drag"</span>,  self.datapoint_drag())
      .on(<span class="string">"touchstart.drag"</span>, self.datapoint_drag());

  circle
      .attr(<span class="string">"class"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> d === self.selected ? <span class="string">"selected"</span> : <span class="literal">null</span>; })
      .attr(<span class="string">"cx"</span>,    <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
        <span class="keyword">return</span> self.x(d.x); })
      .attr(<span class="string">"cy"</span>,    <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> <span class="keyword">return</span> self.y(d.y); });

  circle.exit().remove();

  <span class="keyword">if</span> (d3.event &amp;&amp; d3.event.keyCode) {
    d3.event.preventDefault();
    d3.event.stopPropagation();
  }
}

SimpleGraph.prototype.datapoint_drag = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
    registerKeyboardHandler(self.keydown());
    document.onselectstart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> <span class="literal">false</span>; };
    self.selected = self.dragged = d;
    self.update();
    
  }
};

SimpleGraph.prototype.mousemove = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> p = d3.svg.mouse(self.vis[<span class="number">0</span>][<span class="number">0</span>]),
        t = d3.event.changedTouches;
    
    <span class="keyword">if</span> (self.dragged) {
      self.dragged.y = self.y.invert(Math.max(<span class="number">0</span>, Math.min(self.size.height, p[<span class="number">1</span>])));
      self.update();
    };
    <span class="keyword">if</span> (!isNaN(self.downx)) {
      d3.select(<span class="string">'body'</span>).style(<span class="string">"cursor"</span>, <span class="string">"ew-resize"</span>);
      <span class="keyword">var</span> rupx = self.x.invert(p[<span class="number">0</span>]),
          xaxis1 = self.x.domain()[<span class="number">0</span>],
          xaxis2 = self.x.domain()[<span class="number">1</span>],
          xextent = xaxis2 - xaxis1;
      <span class="keyword">if</span> (rupx != <span class="number">0</span>) {
        <span class="keyword">var</span> changex, new_domain;
        changex = self.downx / rupx;
        new_domain = [xaxis1, xaxis1 + (xextent * changex)];
        self.x.domain(new_domain);
        self.redraw()();
      }
      d3.event.preventDefault();
      d3.event.stopPropagation();
    };
    <span class="keyword">if</span> (!isNaN(self.downy)) {
      d3.select(<span class="string">'body'</span>).style(<span class="string">"cursor"</span>, <span class="string">"ns-resize"</span>);
      <span class="keyword">var</span> rupy = self.y.invert(p[<span class="number">1</span>]),
          yaxis1 = self.y.domain()[<span class="number">1</span>],
          yaxis2 = self.y.domain()[<span class="number">0</span>],
          yextent = yaxis2 - yaxis1;
      <span class="keyword">if</span> (rupy != <span class="number">0</span>) {
        <span class="keyword">var</span> changey, new_domain;
        changey = self.downy / rupy;
        new_domain = [yaxis1 + (yextent * changey), yaxis1];
        self.y.domain(new_domain);
        self.redraw()();
      }
      d3.event.preventDefault();
      d3.event.stopPropagation();
    }
  }
};

SimpleGraph.prototype.mouseup = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    document.onselectstart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> <span class="literal">true</span>; };
    d3.select(<span class="string">'body'</span>).style(<span class="string">"cursor"</span>, <span class="string">"auto"</span>);
    d3.select(<span class="string">'body'</span>).style(<span class="string">"cursor"</span>, <span class="string">"auto"</span>);
    <span class="keyword">if</span> (!isNaN(self.downx)) {
      self.redraw()();
      self.downx = Math.NaN;
      d3.event.preventDefault();
      d3.event.stopPropagation();
    };
    <span class="keyword">if</span> (!isNaN(self.downy)) {
      self.redraw()();
      self.downy = Math.NaN;
      d3.event.preventDefault();
      d3.event.stopPropagation();
    }
    <span class="keyword">if</span> (self.dragged) { 
      self.dragged = <span class="literal">null</span> 
    }
  }
}

SimpleGraph.prototype.keydown = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">if</span> (!self.selected) <span class="keyword">return</span>;
    <span class="keyword">switch</span> (d3.event.keyCode) {
      <span class="keyword">case</span> <span class="number">8</span>: <span class="comment">// backspace</span>
      <span class="keyword">case</span> <span class="number">46</span>: { <span class="comment">// delete</span>
        <span class="keyword">var</span> i = self.points.indexOf(self.selected);
        self.points.splice(i, <span class="number">1</span>);
        self.selected = self.points.length ? self.points[i &gt; <span class="number">0</span> ? i - <span class="number">1</span> : <span class="number">0</span>] : <span class="literal">null</span>;
        self.update();
        <span class="keyword">break</span>;
      }
    }
  }
};

SimpleGraph.prototype.redraw = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
    <span class="keyword">var</span> tx = <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
      <span class="keyword">return</span> <span class="string">"translate("</span> + self.x(d) + <span class="string">",0)"</span>; 
    },
    ty = <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
      <span class="keyword">return</span> <span class="string">"translate(0,"</span> + self.y(d) + <span class="string">")"</span>;
    },
    stroke = <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> 
      <span class="keyword">return</span> d ? <span class="string">"#ccc"</span> : <span class="string">"#666"</span>; 
    },
    fx = self.x.tickFormat(<span class="number">10</span>),
    fy = self.y.tickFormat(<span class="number">10</span>);

    <span class="comment">// Regenerate x-ticks…</span>
    <span class="keyword">var</span> gx = self.vis.selectAll(<span class="string">"g.x"</span>)
        .data(self.x.ticks(<span class="number">10</span>), String)
        .attr(<span class="string">"transform"</span>, tx);

    gx.select(<span class="string">"text"</span>)
        .text(fx);

    <span class="keyword">var</span> gxe = gx.enter().insert(<span class="string">"g"</span>, <span class="string">"a"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"x"</span>)
        .attr(<span class="string">"transform"</span>, tx);

    gxe.append(<span class="string">"line"</span>)
        .attr(<span class="string">"stroke"</span>, stroke)
        .attr(<span class="string">"y1"</span>, <span class="number">0</span>)
        .attr(<span class="string">"y2"</span>, self.size.height);

    gxe.append(<span class="string">"text"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"axis"</span>)
        .attr(<span class="string">"y"</span>, self.size.height)
        .attr(<span class="string">"dy"</span>, <span class="string">"1em"</span>)
        .attr(<span class="string">"text-anchor"</span>, <span class="string">"middle"</span>)
        .text(fx)
        .style(<span class="string">"cursor"</span>, <span class="string">"ew-resize"</span>)
        .on(<span class="string">"mouseover"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> d3.select(<span class="keyword">this</span>).style(<span class="string">"font-weight"</span>, <span class="string">"bold"</span>);})
        .on(<span class="string">"mouseout"</span>,  <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> d3.select(<span class="keyword">this</span>).style(<span class="string">"font-weight"</span>, <span class="string">"normal"</span>);})
        .on(<span class="string">"mousedown.drag"</span>,  self.xaxis_drag())
        .on(<span class="string">"touchstart.drag"</span>, self.xaxis_drag());

    gx.exit().remove();

    <span class="comment">// Regenerate y-ticks…</span>
    <span class="keyword">var</span> gy = self.vis.selectAll(<span class="string">"g.y"</span>)
        .data(self.y.ticks(<span class="number">10</span>), String)
        .attr(<span class="string">"transform"</span>, ty);

    gy.select(<span class="string">"text"</span>)
        .text(fy);

    <span class="keyword">var</span> gye = gy.enter().insert(<span class="string">"g"</span>, <span class="string">"a"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"y"</span>)
        .attr(<span class="string">"transform"</span>, ty)
        .attr(<span class="string">"background-fill"</span>, <span class="string">"#FFEEB6"</span>);

    gye.append(<span class="string">"line"</span>)
        .attr(<span class="string">"stroke"</span>, stroke)
        .attr(<span class="string">"x1"</span>, <span class="number">0</span>)
        .attr(<span class="string">"x2"</span>, self.size.width);

    gye.append(<span class="string">"text"</span>)
        .attr(<span class="string">"class"</span>, <span class="string">"axis"</span>)
        .attr(<span class="string">"x"</span>, -<span class="number">3</span>)
        .attr(<span class="string">"dy"</span>, <span class="string">".35em"</span>)
        .attr(<span class="string">"text-anchor"</span>, <span class="string">"end"</span>)
        .text(fy)
        .style(<span class="string">"cursor"</span>, <span class="string">"ns-resize"</span>)
        .on(<span class="string">"mouseover"</span>, <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> d3.select(<span class="keyword">this</span>).style(<span class="string">"font-weight"</span>, <span class="string">"bold"</span>);})
        .on(<span class="string">"mouseout"</span>,  <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span> d3.select(<span class="keyword">this</span>).style(<span class="string">"font-weight"</span>, <span class="string">"normal"</span>);})
        .on(<span class="string">"mousedown.drag"</span>,  self.yaxis_drag())
        .on(<span class="string">"touchstart.drag"</span>, self.yaxis_drag());

    gy.exit().remove();
    self.plot.call(d3.behavior.zoom().x(self.x).y(self.y).on(<span class="string">"zoom"</span>, self.redraw()));
    self.update();    
  }  
}

SimpleGraph.prototype.xaxis_drag = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
    document.onselectstart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> <span class="literal">false</span>; };
    <span class="keyword">var</span> p = d3.svg.mouse(self.vis[<span class="number">0</span>][<span class="number">0</span>]);
    self.downx = self.x.invert(p[<span class="number">0</span>]);
  }
};

SimpleGraph.prototype.yaxis_drag = <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
  <span class="keyword">var</span> self = <span class="keyword">this</span>;
  <span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(d)</span> {</span>
    document.onselectstart = <span class="function"><span class="keyword">function</span><span class="params">()</span> {</span> <span class="keyword">return</span> <span class="literal">false</span>; };
    <span class="keyword">var</span> p = d3.svg.mouse(self.vis[<span class="number">0</span>][<span class="number">0</span>]);
    self.downy = self.y.invert(p[<span class="number">1</span>]);
  }
};
</code></pre>
    </div>
  </div>
  <div class="gist-license">
    <h2>LICENSE<a name="license" class="anchor" href="http://bl.ocks.org/stepheneb/1182434#license">#</a></h2>
    This block appears to have <a target="_blank" href="http://choosealicense.com/no-license/">no license</a>. Please contact <a target="_blank" href="https://github.com/stepheneb">the author</a> to request a license.
  </div>
</div>

<script src="./D3 Example_ zoom, pan, and axis rescale - bl.ocks.org_files/d3.v3.min.js"></script>
<script src="./D3 Example_ zoom, pan, and axis rescale - bl.ocks.org_files/highlight.min.js"></script>
<script>

var gist = {"public":true,"sha":"56001c031d17f99c5b37788cf53936f98919eeac","files":{"index.html":{"language":"HTML","type":"text/html","filename":"index.html","size":1538,"sha":"342669078e1c65284e1565b7085112a81d0c8353"},"readme.md":{"language":"Markdown","type":"text/plain","filename":"readme.md","size":2011,"sha":"4ca32ca42b7c6dd564fe888bae06f91670767c70"},"simple-graph.js":{"language":"JavaScript","type":"application/javascript","filename":"simple-graph.js","size":11160,"sha":"1e21263d38584abab8c8036a084a482d514ce271"}},"created_at":"2011-08-30T23:52:21Z","updated_at":"2016-05-11T15:44:09Z","description":"D3 Example: zoom, pan, and axis rescale","owner":{"login":"stepheneb"},"id":"1182434"};

var files = d3.values(gist.files);

d3.select(".gist-readme")
    .data(files, function(d) { return d ? d.filename : this.getAttribute("data-key"); })
    .each(function(d) {
      var readme = d3.select(this);
      d3.text("/stepheneb/raw/1182434/56001c031d17f99c5b37788cf53936f98919eeac/" + d.filename, function(error, content) {
        if (error) content = "Sorry, an error occurred.";
        readme.html(new Showdown.converter().makeHtml(content));
        readme.selectAll("code").each(function() { hljs.highlightBlock(this); });
      });
    });

d3.selectAll(".gist-source")
    .data(files, function(d) { return d ? d.filename : this.getAttribute("data-key"); })
  .select("code")
    .attr("class", function(d) { return d.language && (d.language === "JSON" ? "javascript" : d.language.toLowerCase()); })
    .each(function(d) {
      var code = d3.select(this);
      d3.text("/stepheneb/raw/1182434/56001c031d17f99c5b37788cf53936f98919eeac/" + (d.filename === "index.html" ? "" : d.filename), function(error, content) {
        if (error) content = "Sorry, an error occurred.";
        code.text(content);
        hljs.highlightBlock(code.node());
      });
    });

</script>

<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-1", "auto");
ga("send", "pageview");

</script>
<script async="" src="./D3 Example_ zoom, pan, and axis rescale - bl.ocks.org_files/analytics.js"></script>
</body></html>